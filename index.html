<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Lapangan Sepak Bola</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.controls.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <a-scene>
      <!-- Kamera bebas gerak, bisa terbang dan zoom -->
      <a-entity id="cameraRig"
                position="0 1.6 15"
                movement-controls="fly: true; speed: 0.2">
        <a-camera look-controls camera="zoom: 1" id="mainCamera"></a-camera>
      </a-entity>

      <!-- Suara latar -->
      <a-sound id="stadiumSound" src="url(/assets/sounds/training.mp3)" loop="true" volume="10"></a-sound>

      <!-- Lapangan -->
      <a-entity gltf-model="/assets/models/lapangan.glb" position="0 0 0" scale="1 1 1"></a-entity>

      <!-- Bola -->
      <a-entity gltf-model="/assets/models/bola.glb" position="4 0.5 5" scale="0.15 0.15 0.15"></a-entity>

      <!-- Kiper Tim A -->
      <a-entity gltf-model="/assets/models/kiper.glb" position="8 0 1" rotation="0 0 0" scale="0.5 0.5 0.5" animation-mixer="clip: *"></a-entity>

      <!-- Kiper Tim B -->
      <a-entity gltf-model="/assets/models/kiper.glb" position="-9 0 0" rotation="0 0 0" scale="0.5 0.5 0.5" animation-mixer="clip: *"></a-entity>

      <!-- Penonton -->
      <a-entity gltf-model="/assets/models/penonton.glb" position="0.9 1.9 -9" scale="0.9 0.9 0.9" rotation="0 0 0" animation-mixer="clip: *"></a-entity>
      <a-entity gltf-model="/assets/models/penonton.glb" position="5 3 -10" scale="0.9 0.9 0.9" rotation="0 0 0" animation-mixer="clip: *"></a-entity>

      <!-- Pemain akan di-generate lewat JavaScript -->

      <!-- Pencahayaan -->
      <a-light type="ambient" intensity="0.6"></a-light>
      <a-light type="directional" intensity="1" position="0 10 5"></a-light>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const jumlahPemain = 10;

      for (let i = 0; i < jumlahPemain; i++) {
        const pemain = document.createElement('a-entity');
        pemain.setAttribute('id', `pemain${i}`);
        pemain.setAttribute('gltf-model', '/assets/models/pemain.glb');
        pemain.setAttribute('scale', '0.5 0.5 0.5');
        pemain.setAttribute('rotation', '0 -90 0');
        pemain.setAttribute('animation-mixer', 'clip: *');

        const x = -5;
        const z = -5 + i * 1.2;
        pemain.setAttribute('position', `${x} 0 ${z}`);
        scene.appendChild(pemain);

        pemain.addEventListener('model-loaded', () => {
          animatePemain(pemain, x, z);
        });
      }

      function animatePemain(pemain, startX, zPos) {
        let arahKanan = true;

        function gerak() {
          const toX = arahKanan ? 5 : -5;
          const rotY = arahKanan ? 90 : -90;

          pemain.setAttribute('rotation', `0 ${rotY} 0`);
          pemain.setAttribute('animation__move', {
            property: 'position',
            to: `${toX} 0 ${zPos}`,
            dur: 4000 + Math.random() * 1000,
            easing: 'linear',
          });
        }

        pemain.addEventListener('animationcomplete__move', () => {
          arahKanan = !arahKanan;
          gerak();
        });

        gerak();
      }

      const sound = document.querySelector('#stadiumSound');
      function playSoundOnce() {
        sound.components.sound.playSound();
        window.removeEventListener('click', playSoundOnce);
      }
      window.addEventListener('click', playSoundOnce);

      // Zoom in/out dengan scroll mouse
      const camera = document.querySelector('#mainCamera');
      let currentZoom = 1;

      window.addEventListener('wheel', function (e) {
        // Zoom in = scroll ke atas, Zoom out = scroll ke bawah
        if (e.deltaY < 0) {
          currentZoom = Math.max(0.5, currentZoom - 0.1);
        } else {
          currentZoom = Math.min(5, currentZoom + 0.1);
        }
        camera.setAttribute('camera', 'zoom', currentZoom);
      });
    </script>
  </body>
</html>
